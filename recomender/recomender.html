<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1" content="text/html; charset=windows-1252" http-equiv="Content-Type">

<script src="brain.js"></script>
</head>

<body>
<div id="demo"></div>
<script src="data.js"></script>
<script src="csv.js"></script>
<script>



</script>

<script>

	let tekstu="Vnesi uporabni≈°ko ime:";
	let userName = prompt(tekstu);

let storedfilmiOcene = localStorage.getItem('myfilmiOcene'+userName);
let storedlearn = localStorage.getItem('mylearn'+userName);
if (storedfilmiOcene !== null && storedlearn !== null) {
	if (confirm('Uporabnik najden. Pritisni OK za uporabo shranjenega priporocilnega sistema')) {
} else {
	localStorage.clear();
}
}
storedfilmiOcene = localStorage.getItem('myfilmiOcene'+userName);
storedlearn = localStorage.getItem('mylearn'+userName);

if (storedfilmiOcene !== null && storedlearn !== null) {
  console.log("je")
  
  const config = {
  //hiddenLayers: [4,4], // array of ints for the sizes of the hidden layers in the network
  //activation: 'tanh', // supported activation types: ['sigmoid', 'relu', 'leaky-relu', 'tanh'],
  //leakyReluAlpha: 0.01, // supported for activation type 'leaky-relu'
  //errorThresh: 0.005,
  //iterations: 20,
};


let filmiOcene=JSON.parse(localStorage.getItem('myfilmiOcene'+userName));

let learn=JSON.parse(localStorage.getItem('mylearn'+userName));


console.log(learn);

const network = new brain.NeuralNetwork(config);
while(true){


network.train(learn);

let ocene=[];
let result;
let j=0;
while(j<filmiOcene.length){
	result = (network.run(filmiOcene[j][1])[0]);
	ocene.push(result);
	console.log(result);
	
	
	j++;
	
}

const sortedArr = ocene.slice();

sortedArr.sort((a, b) => b - a);

sortedArr.splice(5);

const positions = [];
for (let i = 0; i < sortedArr.length; i++) {
  const num = sortedArr[i];
  const index = ocene.indexOf(num);
  positions.push(index);
}

console.log(positions);

console.log(filmiOcene.length);

let l=0;
while (l<1){
	let num=[positions[l]]
	console.log(filmiOcene);
	let film=filmiOcene[num];
	filmiOcene.splice(num,1);
	let tekst="Priporocena pesem: "+(film[0])+". Oceni jo(od 1 do 5):";
	let userInput = prompt(tekst);
	userInput=(userInput-0.5) /4.5
	learn.push( {input: film[1] ,output:[userInput] });
	
	l++;
}


localStorage.setItem(('myfilmiOcene'+userName), JSON.stringify(filmiOcene));
localStorage.setItem(('mylearn'+userName), JSON.stringify(learn));

}
} else {
  console.log("ni");
  
  if (confirm('Uporabnik na tej napravi ni najden. Pritisni OK za generiranje novega priporocilnega sistema')) {
} else {
	
}
const config = {
  //hiddenLayers: [4,4], // array of ints for the sizes of the hidden layers in the network
  //activation: 'tanh', // supported activation types: ['sigmoid', 'relu', 'leaky-relu', 'tanh'],
  //leakyReluAlpha: 0.01, // supported for activation type 'leaky-relu'
  //errorThresh: 0.005,
  //iterations: 20,
};


let filmiOcene=pesmi;
let learn=[];
i=0
while (i<5){
	let num=i;
	let film=filmiOcene[num]
	filmiOcene.splice(num,1)
	let tekst="Oceni pesem "+(film[0])+"(od 1 do 5):";
	let userInput = prompt(tekst);
	userInput=(userInput-0.5) /4.5
	learn.push( {input: film[1] ,output:[userInput] });
	i++;
}
console.log(learn);

const network = new brain.NeuralNetwork(config);
while(true){


network.train(learn);

let ocene=[];
let result;
let j=0;
while(j<filmiOcene.length){
	result = (network.run(filmiOcene[j][1])[0]);
	ocene.push(result);
	console.log(result);
	
	
	j++;
	
}

const sortedArr = ocene.slice();

sortedArr.sort((a, b) => b - a);

sortedArr.splice(5);

const positions = [];
for (let i = 0; i < sortedArr.length; i++) {
  const num = sortedArr[i];
  const index = ocene.indexOf(num);
  positions.push(index);
}

console.log(positions);

console.log(filmiOcene.length);

let l=0;
while (l<1){
	let num=[positions[l]]
	console.log(filmiOcene);
	let film=filmiOcene[num];
	filmiOcene.splice(num,1);
	let tekst="Priporocena pesem: "+(film[0])+". Oceni jo(od 1 do 5):";
	let userInput = prompt(tekst);
	userInput=(userInput-0.5) /4.5
	learn.push( {input: film[1] ,output:[userInput] });
	
	l++;
}


localStorage.setItem(('myfilmiOcene'+userName), JSON.stringify(filmiOcene));
localStorage.setItem(('mylearn'+userName), JSON.stringify(learn));

}
}


</script>
</body>
</html>
