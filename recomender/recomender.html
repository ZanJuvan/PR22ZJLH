<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1" content="text/html; charset=windows-1252" http-equiv="Content-Type">

<script src="brain.js"></script>
</head>

<body>
<div id="demo"></div>
<script src="data.js"></script>
<script>



</script>

<script>



let storedpesmiOcene = localStorage.getItem('mypesmiOcene');
let storedlearn = localStorage.getItem('mylearn');
let storedVseOcene = localStorage.getItem('myVseOcene');
let storedPozOcene = localStorage.getItem('myPozOcene');
if (storedpesmiOcene !== null && storedlearn !== null && storedPozOcene!==null && storedVseOcene !== null) {
	if (confirm('Uporabnik najden. Pritisni OK za uporabo shranjenega priporocilnega sistema')) {
} else {
	localStorage.clear();
}
}
storedpesmiOcene = JSON.parse(localStorage.getItem('mypesmiOcene'));
storedlearn = JSON.parse(localStorage.getItem('mylearn'));

if (storedpesmiOcene !== null && storedlearn !== null) {
  console.log("je")
  let vseOcene=storedVseOcene;
  let pozOcene=storedPozOcene;
  const config = {
  //hiddenLayers: [4,4], // array of ints for the sizes of the hidden layers in the network
  //activation: 'tanh', // supported activation types: ['sigmoid', 'relu', 'leaky-relu', 'tanh'],
  //leakyReluAlpha: 0.01, // supported for activation type 'leaky-relu'
  //errorThresh: 0.005,
  //iterations: 20,
};


let pesmiOcene=JSON.parse(localStorage.getItem('mypesmiOcene'));

let learn=JSON.parse(localStorage.getItem('mylearn'));


console.log(learn);

const network = new brain.NeuralNetwork(config);
while(true){


network.train(learn);

let ocene=[];
let result;
let j=0;
while(j<pesmiOcene.length){
	result = (network.run(pesmiOcene[j][1])[0]);
	ocene.push(result);
	console.log(result);
	
	
	j++;
	
}

const sortedArr = ocene.slice();

sortedArr.sort((a, b) => b - a);

sortedArr.splice(5);

const positions = [];
for (let i = 0; i < sortedArr.length; i++) {
  const num = sortedArr[i];
  const index = ocene.indexOf(num);
  positions.push(index);
}

console.log(positions);

console.log(pesmiOcene.length);

let l=0;
while (l<1){
	let num=[positions[l]]
	console.log(pesmiOcene);
	let pesm=pesmiOcene[num];
	pesmiOcene.splice(num,1);
	let userInput
	if (confirm("Priporocena pesem: "+(pesm[0])+"klikni OK ce ti je vsec in cancel ce ti ni. Trenutna natancnost:"+(pozOcene/vseOcene) )) {
	userInput = 5;
	pozOcene++;
	vseOcene++;
	} else {
	userInput = 1;
	vseOcene++;
	}
	
	userInput=(userInput-0.5) /4.5
	learn.push( {input: pesm[1] ,output:[userInput] });
	
	l++;
}


localStorage.setItem(('mypesmiOcene'), JSON.stringify(pesmiOcene));
localStorage.setItem(('mylearn'), JSON.stringify(learn));
localStorage.setItem(('myVseOcene'), JSON.stringify(vseOcene));
localStorage.setItem(('myPozOcene'), JSON.stringify(pozOcene));

}
} else {
  console.log("ni");
  let pozOcene=0;
  let vseOcene=0;

const config = {
  //hiddenLayers: [4,4], // array of ints for the sizes of the hidden layers in the network
  //activation: 'tanh', // supported activation types: ['sigmoid', 'relu', 'leaky-relu', 'tanh'],
  //leakyReluAlpha: 0.01, // supported for activation type 'leaky-relu'
  //errorThresh: 0.005,
  //iterations: 20,
};


let pesmiOcene=pesmi;
let learn=[];
i=0
while (i<5){
	let num=i;
	let pesm=pesmiOcene[num]
	pesmiOcene.splice(num,1)
	let userInput
	if (confirm("Priporocena pesem: "+(pesm[0])+"klikni OK ce ti je vsec in cancel ce ti ni. Trenutna natancnost:"+(pozOcene/vseOcene) )) {
	userInput = 5;
	pozOcene++;
	vseOcene++;
	} else {
	userInput = 1;
	vseOcene++;
	}
	userInput=(userInput-0.5) /4.5
	learn.push( {input: pesm[1] ,output:[userInput] });
	i++;
}
console.log(learn);

const network = new brain.NeuralNetwork(config);
while(true){


network.train(learn);

let ocene=[];
let result;
let j=0;
while(j<pesmiOcene.length){
	result = (network.run(pesmiOcene[j][1])[0]);
	ocene.push(result);
	console.log(result);
	
	
	j++;
	
}

const sortedArr = ocene.slice();

sortedArr.sort((a, b) => b - a);

sortedArr.splice(5);

const positions = [];
for (let i = 0; i < sortedArr.length; i++) {
  const num = sortedArr[i];
  const index = ocene.indexOf(num);
  positions.push(index);
}

console.log(positions);

console.log(pesmiOcene.length);

let l=0;
while (l<1){
	let num=[positions[l]]
	console.log(pesmiOcene);
	let pesm=pesmiOcene[num];
	pesmiOcene.splice(num,1);
let userInput
	if (confirm("Priporocena pesem: "+(pesm[0])+". Klikni OK ce ti je vsec in cancel ce ti ni. Trenutna natancnost:"+(pozOcene/vseOcene) )) {
	userInput = 5;
	pozOcene++;
	vseOcene++;
	} else {
	userInput = 1;
	vseOcene++;
	}
	userInput=(userInput-0.5) /4.5
	learn.push( {input: pesm[1] ,output:[userInput] });
	
	l++;
}


localStorage.setItem(('mypesmiOcene'), JSON.stringify(pesmiOcene));
localStorage.setItem(('mylearn'), JSON.stringify(learn));
localStorage.setItem(('myVseOcene'), JSON.stringify(vseOcene));
localStorage.setItem(('myPozOcene'), JSON.stringify(pozOcene));
}
}


</script>
</body>
</html>
